<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>TSH Scholars Map</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Leaflet -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>

  <!-- MarkerCluster (optional but nice if many points) -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css"
  />
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css"
  />
  <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>

  <style>
    :root {
      --bg: #0f1115;         /* dark UI */
      --panel: #151822;
      --text: #f3f5f7;
      --muted: #a7b0c0;
      --accent: #8be2d4;     /* mint */
      --chip: #23283a;
    }
    body {
      margin: 0; background: var(--bg); color: var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans";
    }
    header { display:flex; align-items:center; gap:.8rem; padding:14px 16px; background: var(--panel); border-bottom:1px solid #22283a; }
    header h1 { font-size:16px; margin:0; font-weight:600; letter-spacing:.3px; }
    #app { display:grid; grid-template-columns: 320px 1fr; height: calc(100vh - 58px); }
    #sidebar { background: var(--panel); border-right:1px solid #22283a; padding:14px; overflow:auto; }
    #map { width:100%; height:100%; }
    .stat { display:flex; justify-content:space-between; padding:10px 12px; background: #111622; border:1px solid #1b2032; border-radius:10px; margin:8px 0; }
    .chip { display:inline-flex; align-items:center; gap:.4rem; background: var(--chip); border:1px solid #2a3046; padding:6px 10px; border-radius:999px; font-size:12px; color: var(--muted); }
    .controls { display:grid; gap:10px; margin:12px 0 6px; }
    .controls label { font-size:13px; color: var(--muted); display:flex; align-items:center; gap:.6rem; }
    .range-wrap { margin-top:6px; }
    .range-wrap input { width:100%; }
    .legend { font-size:12px; color: var(--muted); margin-top:8px; }
    .footer { font-size:12px; color: var(--muted); margin-top:10px; }
    .popup h3 { margin:.2rem 0 .6rem; font-size:16px; }
    .grid2 { display:grid; grid-template-columns:1fr 1fr; gap:6px; }
    .kpi { background:#0f1420; border:1px solid #1b2032; border-radius:8px; padding:8px; text-align:center; }
    .kpi .label { color:var(--muted); font-size:11px; }
    .kpi .value { font-size:18px; font-weight:700; }
    .btn { background: var(--accent); border:none; color:#0b1b18; font-weight:700; padding:10px 12px; border-radius:10px; cursor:pointer; }
    .btn.secondary { background: #263047; color: var(--text); border:1px solid #2d3754; }
    @media (max-width: 900px) { #app { grid-template-columns: 1fr; } #sidebar { order: 2; height: auto; } #map { height: 60vh; } }
  </style>
</head>
<body>
  <header>
    <h1>TSH Scholars ‚Äî Europe Map</h1>
  </header>

  <div id="app">
    <aside id="sidebar">
      <div class="stat"><div>Total Cities</div><div id="stat-cities">0</div></div>
      <div class="stat"><div>Total Scholars</div><div id="stat-total">0</div></div>
      <div class="controls">
        <label><input type="checkbox" id="toggle-current" checked /> Show All</label>
        <div class="range-wrap">
          <div class="chip">Cohort year ‚â§ <span id="year-label">2025</span></div>
          <input id="year-max" type="range" min="2015" max="2025" value="2025" />
        </div>
        <button class="btn secondary" id="reset-view">Reset View</button>
      </div>
      <div class="legend">Click a city to zoom and view counts. This version already includes the 111 scholars.</div>
      <div class="footer">Made for The Social Hub ü§ç</div>
    </aside>
    <div id="map"></div>
  </div>

  <script>
    const map = L.map('map', { zoomControl: true, scrollWheelZoom: true }).setView([51.5, 9], 5);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 18, attribution: '&copy; OpenStreetMap contributors' }).addTo(map);

    const cluster = L.markerClusterGroup({ showCoverageOnHover: false });
    let markers = [];
    let yearMax = 2025;

    const els = {
      statCities: document.getElementById('stat-cities'),
      statTotal:  document.getElementById('stat-total'),
      yearMax: document.getElementById('year-max'),
      yearLabel: document.getElementById('year-label'),
      resetView: document.getElementById('reset-view')
    };

    const records = [
      {city:'Rome',country:'Italy',lat:41.9028,lng:12.4964,current_count:8,start_year:2020,end_year:2025},
      {city:'Florence',country:'Italy',lat:43.7696,lng:11.2558,current_count:10,start_year:2020,end_year:2025},
      {city:'Bologna',country:'Italy',lat:44.4949,lng:11.3426,current_count:1,start_year:2021,end_year:2025},
      {city:'Amsterdam City',country:'Netherlands',lat:52.3702,lng:4.8952,current_count:6,start_year:2020,end_year:2025},
      {city:'Amsterdam West',country:'Netherlands',lat:52.369,lng:4.853,current_count:10,start_year:2019,end_year:2025},
      {city:'Rotterdam',country:'Netherlands',lat:51.924,lng:4.478,current_count:8,start_year:2019,end_year:2025},
      {city:'Delft',country:'Netherlands',lat:51.9995,lng:4.3627,current_count:3,start_year:2020,end_year:2025},
      {city:'Eindhoven',country:'Netherlands',lat:51.4416,lng:5.4697,current_count:2,start_year:2020,end_year:2025},
      {city:'The Hague',country:'Netherlands',lat:52.0705,lng:4.3007,current_count:6,start_year:2020,end_year:2025},
      {city:'Maastricht',country:'Netherlands',lat:50.8514,lng:5.691,current_count:5,start_year:2021,end_year:2025},
      {city:'Toulouse',country:'France',lat:43.6047,lng:1.4442,current_count:1,start_year:2022,end_year:2025},
      {city:'Barcelona',country:'Spain',lat:41.3851,lng:2.1734,current_count:7,start_year:2021,end_year:2025},
      {city:'Madrid',country:'Spain',lat:40.4168,lng:-3.7038,current_count:6,start_year:2021,end_year:2025},
      {city:'San Sebastian',country:'Spain',lat:43.3183,lng:-1.9812,current_count:2,start_year:2022,end_year:2025},
      {city:'Berlin',country:'Germany',lat:52.52,lng:13.405,current_count:6,start_year:2020,end_year:2025},
      {city:'Glasgow',country:'United Kingdom',lat:55.8642,lng:-4.2518,current_count:8,start_year:2020,end_year:2025},
      {city:'Vienna',country:'Austria',lat:48.2082,lng:16.3738,current_count:10,start_year:2020,end_year:2025},
      {city:'Porto',country:'Portugal',lat:41.1579,lng:-8.6291,current_count:9,start_year:2020,end_year:2025}
    ];

    function buildMarkers() {
      cluster.clearLayers();
      markers = [];
      let total = 0;

      records.forEach(rec => {
        if ((rec.start_year || 0) > yearMax) return;
        total += rec.current_count;
        const marker = L.circleMarker([rec.lat, rec.lng], {
          radius: Math.max(6, Math.min(18, 6 + Math.sqrt(rec.current_count))),
          weight: 1,
          color: '#2c3754',
          fillColor: '#8be2d4',
          fillOpacity: 0.85
        });

        marker.bindPopup(`
          <div>
            <h3>${rec.city}, ${rec.country}</h3>
            <div class="grid2">
              <div class="kpi"><div class="label">Students</div><div class="value">${rec.current_count}</div></div>
              <div class="kpi"><div class="label">Start Year</div><div class="value">${rec.start_year}</div></div>
            </div>
          </div>
        `, { className: 'popup' });

        marker.on('click', () => map.setView([rec.lat, rec.lng], 11, { animate: true }));
        markers.push(marker);
        cluster.addLayer(marker);
      });

      map.addLayer(cluster);
      els.statCities.textContent = records.length;
      els.statTotal.textContent = total;
    }

    els.yearMax.addEventListener('input', (e) => {
      yearMax = +e.target.value;
      els.yearLabel.textContent = yearMax;
      buildMarkers();
    });

    els.resetView.addEventListener('click', () => map.setView([51.5, 9], 5));
    buildMarkers();
  </script>
</body>
</html>
