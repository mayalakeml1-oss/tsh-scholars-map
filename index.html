<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>TSH Scholars Map</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Leaflet + MarkerCluster -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
  <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>

  <style>
    :root{
      --bg:#ffeef4;            /* soft pink background */
      --panel:#ffffff;         /* white panels */
      --text:#2a1820;          /* deep rose-brown text */
      --muted:#8b6677;         /* muted mauve */
      --accent:#FFC2D0;        /* main accent (your hex) */
      --accent-dark:#f78ca6;   /* deeper pink for hover */
      --chip:#ffe0eb;          /* light chip */
      --border:#ffd1df;
    }
    *{box-sizing:border-box;}
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font-family:"Inter","Helvetica Neue",Arial,sans-serif;
    }
    header{
      display:flex;
      align-items:center;
      justify-content:center;
      background:linear-gradient(90deg,#ff9fba,#FFC2D0,#ff9fba);
      color:#3e1020;
      padding:16px;
      font-size:18px;
      font-weight:700;
      letter-spacing:.4px;
      text-transform:uppercase;
    }
    #app{
      display:grid;
      grid-template-columns:340px 1fr;
      height:calc(100vh - 64px);
    }
    #sidebar{
      background:var(--panel);
      border-right:2px solid var(--border);
      padding:20px;
      overflow-y:auto;
    }
    #map{
      width:100%;
      height:100%;
    }

    .stat{
      display:flex;
      justify-content:space-between;
      padding:10px 12px;
      background:var(--chip);
      border:1px solid var(--border);
      border-radius:12px;
      margin:8px 0;
      font-size:14px;
    }
    .stat div:last-child{
      font-weight:700;
    }

    .chip{
      display:inline-flex;
      align-items:center;
      gap:.4rem;
      background:var(--chip);
      border:1px solid var(--border);
      padding:6px 10px;
      border-radius:999px;
      font-size:12px;
      color:var(--muted);
    }
    .controls{
      display:grid;
      gap:10px;
      margin:16px 0;
    }
    .range-wrap input{
      width:100%;
      accent-color:var(--accent);
    }
    .btn{
      background:var(--accent);
      border:none;
      color:#3e1020;
      font-weight:600;
      padding:10px 12px;
      border-radius:999px;
      cursor:pointer;
      font-size:13px;
      box-shadow:0 4px 10px rgba(0,0,0,.05);
      transition:all .18s ease-in-out;
    }
    .btn:hover{
      background:var(--accent-dark);
      transform:translateY(-1px);
      box-shadow:0 6px 14px rgba(0,0,0,.08);
    }
    .legend{
      font-size:13px;
      color:var(--muted);
      margin-top:10px;
      line-height:1.4;
    }
    .footer{
      font-size:12px;
      color:var(--muted);
      margin-top:20px;
      text-align:center;
    }

    .popup h3{
      margin:.2rem 0 .6rem;
      font-size:16px;
      color:#b73463;
    }
    .kpis{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:6px;
      margin-bottom:6px;
    }
    .kpi{
      background:var(--chip);
      border:1px solid var(--border);
      border-radius:10px;
      padding:8px;
      text-align:center;
    }
    .kpi .label{
      color:var(--muted);
      font-size:11px;
    }
    .kpi .value{
      font-size:18px;
      font-weight:700;
    }
    .cohort-row{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      margin:6px 0;
      padding:8px 10px;
      border:1px solid var(--border);
      border-radius:10px;
      background:#fff8fb;
      font-size:12px;
    }
    .cohort-row .meta{
      color:var(--muted);
      margin-top:2px;
    }

    /* Modal */
    .modal{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.45);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:9999;
    }
    .modal.open{
      display:flex;
    }
    .modal-content{
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:18px;
      width:min(1100px,94vw);
      max-height:88vh;
      overflow:hidden;
      display:flex;
      flex-direction:column;
      box-shadow:0 20px 40px rgba(0,0,0,.25);
    }
    .modal-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:12px 16px;
      border-bottom:1px solid var(--border);
      background:linear-gradient(90deg,#ffe0eb,#ffffff);
    }
    .modal-header h2{
      margin:0;
      font-size:16px;
    }
    .modal-controls{
      display:flex;
      gap:8px;
      padding:10px 12px;
      border-bottom:1px solid var(--border);
    }
    .input{
      background:#fff;
      border:1px solid #f0d4de;
      color:var(--text);
      border-radius:999px;
      padding:8px 12px;
      font-size:13px;
      width:100%;
    }
    .input:focus{
      outline:none;
      border-color:var(--accent);
      box-shadow:0 0 0 2px rgba(255,194,208,.4);
    }
    .modal-body{
      padding:12px;
      overflow:auto;
      background:#fff8fb;
    }
    .scholars-grid{
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(240px,1fr));
      gap:12px;
    }
    .scholar-card{
      display:flex;
      gap:10px;
      padding:10px;
      border:1px solid #f0d4de;
      border-radius:14px;
      background:#ffffff;
    }
    .scholar-card img{
      width:64px;
      height:64px;
      object-fit:cover;
      border-radius:12px;
      background:#f7d3e0;
      flex-shrink:0;
    }
    .scholar-meta{
      display:flex;
      flex-direction:column;
      gap:2px;
    }
    .scholar-name{
      font-weight:700;
      font-size:14px;
    }
    .scholar-study{
      font-size:12px;
      color:var(--muted);
    }
    .scholar-uni{
      font-size:12px;
      color:#b73463;
    }
    .scholar-tags{
      display:flex;
      gap:6px;
      flex-wrap:wrap;
      margin-top:6px;
    }
    .tag{
      font-size:11px;
      padding:3px 8px;
      border-radius:999px;
      background:var(--chip);
      border:1px solid var(--border);
      color:var(--muted);
    }

    @media(max-width:900px){
      #app{grid-template-columns:1fr;}
      #sidebar{order:2;height:auto;}
      #map{height:60vh;}
    }
  </style>
</head>

<body>
  <header>TSH Scholars Map</header>

  <div id="app">
    <aside id="sidebar">
      <div class="stat"><div>Total Cities</div><div id="stat-cities">0</div></div>
      <div class="stat"><div>Total Scholars (visible)</div><div id="stat-total">0</div></div>

      <div class="controls">
        <div class="range-wrap">
          <div class="chip">
            Cohorts starting ≤ <span id="year-label">2026</span>
          </div>
          <input id="year-max" type="range" min="2023" max="2026" value="2026" />
        </div>
        <button class="btn" id="reset-view">Reset view to Europe</button>
      </div>

      <div class="legend">
        Click a city to see the cohort breakdown and open the detailed scholar profiles.
      </div>
      <div class="footer">
        The Social Hub • 2023–Present Scholars
      </div>
    </aside>

    <div id="map"></div>
  </div>

  <!-- Scholar modal -->
  <div class="modal" id="scholar-modal" aria-hidden="true" role="dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="modal-title">Scholars</h2>
        <button class="btn" id="close-modal">Close</button>
      </div>
      <div class="modal-controls">
        <input id="scholar-search" class="input" placeholder="Search by name, study, university…" />
      </div>
      <div class="modal-body">
        <div id="scholars-container" class="scholars-grid"></div>
      </div>
    </div>
  </div>

  <script>
    // === Map setup (English OSM) ===
    const map = L.map('map',{zoomControl:true,scrollWheelZoom:true}).setView([51.5,9],5);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
      maxZoom:18,
      attribution:'&copy; OpenStreetMap contributors'
    }).addTo(map);
    const cluster = L.markerClusterGroup({ showCoverageOnHover:false });

    // === City + cohort + scholar data ===
    // 2023–2024 counts based on your earlier numbers.
    // 2025–2026 scholars based on the full list you provided (total 108).
    // Dayana has a photo at images/dayana-milieva.jpg.

    const cities = [
      {
        city: 'Rome',
        country: 'Italy',
        lat: 41.9028, lng: 12.4964,
        cohorts: [
          {
            start: 2025, end: 2026,
            count: 8,
            scholars: [
              {
                name: 'Dayana Milieva',
                study: 'MA International Affairs',
                university: 'John Cabot University',
                photo: 'images/dayana-milieva.jpg'
              },
              {
                name: 'Xani Beatriz Villaraos Seres',
                study: '-',
                university: 'Rome University of Fine Arta (RUFA)',
                photo: ''
              },
              {
                name: 'Anna Bilous',
                study: 'MA Visual and Innovation Design',
                university: 'Rome University of Fine Arta (RUFA)',
                photo: ''
              },
              {
                name: 'Alberto Cabo Valcarce',
                study: 'MA Accessories Design',
                university: 'Accademia Costume and Moda',
                photo: ''
              },
              {
                name: 'Luiza Osam-Gyaabin',
                study: 'MA Fabric Innovation Design',
                university: 'Accademia Costume and Moda',
                photo: ''
              },
              {
                name: 'Yazeed Isied',
                study: 'MA Cinema and Film Production',
                university: 'RomaTre',
                photo: ''
              },
              {
                name: 'Basma Almaza',
                study: 'MA International Studies',
                university: 'RomaTre',
                photo: ''
              },
              {
                name: 'Maria Vitoria De Andrade Da Silva',
                study: 'MA Jewelry Design',
                university: 'Accademia Italiana (IAAD)',
                photo: ''
              },
            ]
          },
        ]
      },
      {
        city: 'Florence',
        country: 'Italy',
        lat: 43.7696, lng: 11.2558,
        cohorts: [
          {
            start: 2023, end: 2024,
            count: 1,
            scholars: []
          },
          {
            start: 2025, end: 2026,
            count: 10,
            scholars: [
              {
                name: 'Claudia Terova Carbajal',
                study: 'MSc Luxury Retail & Business Management',
                university: 'Polimoda',
                photo: ''
              },
              {
                name: 'Taylor Te Whiwhi Wallbank',
                study: 'Young Artist Programme',
                university: 'Mascarade Opera',
                photo: ''
              },
              {
                name: 'Vuyisa Xipu',
                study: 'Opera Studio',
                university: 'Mascarade Opera',
                photo: ''
              },
              {
                name: 'Katerina Borelli',
                study: 'PhD Law',
                university: 'EUI',
                photo: ''
              },
              {
                name: 'Friederike Orschler',
                study: 'MA Transnational Governance',
                university: 'EUI',
                photo: ''
              },
              {
                name: 'Milla Trinchero',
                study: 'MA Transnational Governance',
                university: 'EUI',
                photo: ''
              },
              {
                name: 'Mostafa Hatem Mostafa Zaki Tana',
                study: 'PhD Law',
                university: 'EUI',
                photo: ''
              },
              {
                name: 'Ahmet Hakan Kayhan',
                study: 'MA Transnational Governance',
                university: 'EUI',
                photo: ''
              },
              {
                name: 'Shuyang Wu',
                study: 'MRes Economics',
                university: 'EUI',
                photo: ''
              },
              {
                name: 'Vito Giacobelli',
                study: 'Biennio di Graphic Design',
                university: 'Academia Italiana',
                photo: ''
              },
            ]
          },
        ]
      },
      {
        city: 'Bologna',
        country: 'Italy',
        lat: 44.4949, lng: 11.3426,
        cohorts: [
          {
            start: 2025, end: 2026,
            count: 1,
            scholars: [
              {
                name: 'Laura Zorzi',
                study: 'MA Professional Arrangement and Composition',
                university: 'Creative Hub academy',
                photo: ''
              },
            ]
          },
        ]
      },
      {
        city: 'Amsterdam City',
        country: 'Netherlands',
        lat: 52.3702, lng: 4.8952,
        cohorts: [
          {
            start: 2025, end: 2026,
            count: 6,
            scholars: [
              {
                name: 'Joe Gimpel',
                study: 'International Business',
                university: 'HvA - Amsterdam University of Applied Sciences',
                photo: ''
              },
              {
                name: 'Junbing Liao',
                study: 'MSc Metropolitan Analysis Design & Engineering',
                university: 'Amsterdam Institute for Advanced Metropolitan Solutions Wageningen University & Research',
                photo: ''
              },
              {
                name: 'Asal Moradi',
                study: 'MSc Metropolitan Analysis Design & Engineering',
                university: 'Amsterdam Institute for Advanced Metropolitan Solutions Wageningen University & Research',
                photo: ''
              },
              {
                name: 'Jose Abraham Villanueva Cuellar',
                study: 'MSc Metropolitan Analysis Design & Engineering',
                university: 'Amsterdam Institute for Advanced Metropolitan Solutions Wageningen University & Research',
                photo: ''
              },
              {
                name: 'Ruthler Louis',
                study: 'Software Engineering',
                university: 'CODAM',
                photo: ''
              },
              {
                name: 'Frederico Campanello',
                study: 'Doublebass Master',
                university: 'AHK- Conservatorium Amsterdam',
                photo: ''
              },
            ]
          },
        ]
      },
      {
        city: 'Amsterdam West',
        country: 'Netherlands',
        lat: 52.369, lng: 4.853,
        cohorts: [
          {
            start: 2023, end: 2024,
            count: 2,
            scholars: []
          },
          {
            start: 2025, end: 2026,
            count: 10,
            scholars: [
              {
                name: 'Eiman Elgaali',
                study: 'MA Public Health and Health Equity',
                university: 'KIT Institute',
                photo: ''
              },
              {
                name: 'Phan Minh Thai',
                study: 'MA Public Health and Health Equity',
                university: 'KIT Institute',
                photo: ''
              },
              {
                name: 'Nataliia Sulym',
                study: 'MA Music',
                university: 'AHK - Conservatorium Amsterdam',
                photo: ''
              },
              {
                name: 'Kirutharshan Nicholas John Mariyathas',
                study: 'MA Theatre Makers and Curators in the performing arts',
                university: 'AHK - Amsterdam University of Arts',
                photo: ''
              },
              {
                name: 'El Mehdi Banacer',
                study: 'MArch Architecture',
                university: 'AHK - Amsterdam University of Arts',
                photo: ''
              },
              {
                name: 'Shuang Yu',
                study: 'MA Film',
                university: 'AHK - Amsterdam University of Arts',
                photo: ''
              },
              {
                name: 'Aditya Jain',
                study: 'MA Applied Museum and Heritage Studies',
                university: 'AHK - Amsterdam University of Arts',
                photo: ''
              },
              {
                name: 'Itan Nikelskii',
                study: '-',
                university: 'CODAM',
                photo: ''
              },
              {
                name: 'Antonio Cossari',
                study: 'BA Software Engineering',
                university: 'CODAM',
                photo: ''
              },
              {
                name: 'Julian Zienert',
                study: 'CODAM core',
                university: 'CODAM',
                photo: ''
              },
            ]
          },
        ]
      },
      {
        city: 'Rotterdam',
        country: 'Netherlands',
        lat: 51.924, lng: 4.478,
        cohorts: [
          {
            start: 2023, end: 2024,
            count: 9,
            scholars: []
          },
          {
            start: 2025, end: 2026,
            count: 8,
            scholars: [
              {
                name: 'Georgios Chomatas',
                study: 'MA Applied History',
                university: 'Erasmus University Rotterdam',
                photo: ''
              },
              {
                name: 'Simon Playe',
                study: 'MA.',
                university: 'Erasmus University Rotterdam',
                photo: ''
              },
              {
                name: 'Samuele Pollichemi',
                study: 'MSc Strategic Management',
                university: 'Erasmus University Rotterdam',
                photo: ''
              },
              {
                name: 'Giulia di Santo-Portelli',
                study: 'MA Societal Transitions',
                university: 'Erasmus University Rotterdam',
                photo: ''
              },
              {
                name: 'Pavlos Palvou',
                study: 'MSc Finance and Investments',
                university: 'Erasmus University Rotterdam',
                photo: ''
              },
              {
                name: 'Hien Luong Lai',
                study: 'MSc',
                university: 'Erasmus University Rotterdam',
                photo: ''
              },
              {
                name: 'Lauren Zableckis',
                study: 'MSc Genomics in Society',
                university: 'Erasmus University Rotterdam',
                photo: ''
              },
              {
                name: 'Negul Devan Kesadev Rajeswari',
                study: 'MSc Urban Management and Development',
                university: 'IHS',
                photo: ''
              },
            ]
          },
        ]
      },
      {
        city: 'Delft',
        country: 'Netherlands',
        lat: 51.9995, lng: 4.3627,
        cohorts: [
          {
            start: 2025, end: 2026,
            count: 3,
            scholars: [
              {
                name: 'Milagro Vasquez',
                study: 'MSc Programme in Water and Sustainable Development',
                university: 'IHE',
                photo: ''
              },
              {
                name: 'Esraa Omer Mukhtar',
                study: 'MSc Programme in Water and Sustainable Development',
                university: 'IHE',
                photo: ''
              },
              {
                name: 'Musulene Sharpolu',
                study: 'MSc Programme in Water and Sustainable Development',
                university: 'IHE',
                photo: ''
              },
            ]
          },
        ]
      },
      {
        city: 'Eindhoven',
        country: 'Netherlands',
        lat: 51.4416, lng: 5.4697,
        cohorts: [
          {
            start: 2025, end: 2026,
            count: 2,
            scholars: [
              {
                name: 'Jiwon Hyun',
                study: 'MA Societal Design',
                university: 'Design Academy Eindhoven',
                photo: ''
              },
              {
                name: 'Jaeyoung Lee',
                study: 'MA Contextual Design',
                university: 'Design Academy Eindhoven',
                photo: ''
              },
            ]
          },
        ]
      },
      {
        city: 'The Hague',
        country: 'Netherlands',
        lat: 52.0705, lng: 4.3007,
        cohorts: [
          {
            start: 2023, end: 2024,
            count: 2,
            scholars: []
          },
          {
            start: 2025, end: 2026,
            count: 6,
            scholars: [
              {
                name: 'Udey Dahir',
                study: 'MSc Crisis and Security Management',
                university: 'Leiden University The Hague',
                photo: ''
              },
              {
                name: 'Pragya Misra',
                study: 'MA Development Studies',
                university: 'ISS - EUR The Hague',
                photo: ''
              },
              {
                name: 'Gillian Kipkemboi',
                study: 'MA Development Studies',
                university: 'ISS - EUR The Hague',
                photo: ''
              },
              {
                name: 'Miyu Nohashi',
                study: 'MA Music Performance in Early Music',
                university: 'Royal Conservatory The Hague',
                photo: ''
              },
              {
                name: 'Leslie Perez-Canto Azaf',
                study: 'NMO National Master In Orchestral Conducting',
                university: 'Royal Conservatory The Hague',
                photo: ''
              },
              {
                name: 'Zakaria Haij',
                study: 'MSc Environmental Engineering',
                university: 'TU Delft',
                photo: ''
              },
            ]
          },
        ]
      },
      {
        city: 'Maastricht',
        country: 'Netherlands',
        lat: 50.8514, lng: 5.691,
        cohorts: [
          {
            start: 2023, end: 2024,
            count: 4,
            scholars: []
          },
          {
            start: 2025, end: 2026,
            count: 5,
            scholars: [
              {
                name: 'Emma Przygodda',
                study: 'European Studies on Society, Science and Technology',
                university: 'Maastricht University',
                photo: ''
              },
              {
                name: 'Lea Rebekka Wegert',
                study: 'MSc Cultures of Arts, Science and Technology',
                university: 'Maastricht University',
                photo: ''
              },
              {
                name: 'Nikita Chepkeyvch',
                study: 'MSc Economics and Strategy in Emerging Markets',
                university: 'Maastricht University',
                photo: ''
              },
              {
                name: 'Burak Nuri Demirci',
                study: 'MSc Psychology: Spec Work & Organizational Psychology',
                university: 'Maastricht University',
                photo: ''
              },
              {
                name: 'Doljinsuren Tumurbaatar',
                study: 'MSC Public Policy and Human Development',
                university: 'Maastricht University',
                photo: ''
              },
            ]
          },
        ]
      },
      {
        city: 'Toulouse',
        country: 'France',
        lat: 43.6047, lng: 1.4442,
        cohorts: [
          {
            start: 2023, end: 2024,
            count: 3,
            scholars: []
          },
          {
            start: 2025, end: 2026,
            count: 1,
            scholars: [
              {
                name: 'Mamadou Aliou Diallo',
                study: 'MA Economie Appliquée',
                university: 'Toulouse School of Economics',
                photo: ''
              },
            ]
          },
        ]
      },
      {
        city: 'Barcelona',
        country: 'Spain',
        lat: 41.3851, lng: 2.1734,
        cohorts: [
          {
            start: 2023, end: 2024,
            count: 2,
            scholars: []
          },
          {
            start: 2025, end: 2026,
            count: 7,
            scholars: [
              {
                name: 'Aimen Lakroum',
                study: 'Bachelors English and French Studies',
                university: 'Universitat Autonoma de Barcelona (UAB)',
                photo: ''
              },
              {
                name: 'Muhammad Usman',
                study: 'MA Telecommunication Engineering',
                university: 'Universitat Autonoma de Barcelona (UAB)',
                photo: ''
              },
              {
                name: 'Malik Abdalaal',
                study: 'MSc Research and Innovation in Computer based Science and Engineering',
                university: 'Universitat Autonoma de Barcelona (UAB)',
                photo: ''
              },
              {
                name: 'Jesuferanmi Bankole',
                study: 'MA Business Administration',
                university: 'ESADE',
                photo: ''
              },
              {
                name: 'Aswini Kumar',
                study: 'MSc International Management',
                university: 'ESADE',
                photo: ''
              },
              {
                name: 'Idris Mohammad',
                study: 'MSc International Management',
                university: 'ESADE',
                photo: ''
              },
              {
                name: 'Chelsea Sabine Sangwa',
                study: 'International Master in Sustainable Business and Innovation',
                university: 'EADA',
                photo: ''
              },
            ]
          },
        ]
      },
      {
        city: 'Madrid',
        country: 'Spain',
        lat: 40.4168, lng: -3.7038,
        cohorts: [
          {
            start: 2023, end: 2024,
            count: 4,
            scholars: []
          },
          {
            start: 2025, end: 2026,
            count: 6,
            scholars: [
              {
                name: 'Iasmina Sharapova',
                study: 'MA Management',
                university: 'IE University',
                photo: ''
              },
              {
                name: 'Shayna van Vuren',
                study: 'MSc Sustainability and Business Transformation',
                university: 'IE University',
                photo: ''
              },
              {
                name: 'Juan Pablo Hernández Mejía',
                study: 'MA Cultural Project Management',
                university: 'La Fabrica',
                photo: ''
              },
              {
                name: 'Juan Glassford',
                study: 'MA Photographic Projects',
                university: 'La Fabrica',
                photo: ''
              },
              {
                name: 'Azti Correa Alamimos',
                study: 'MA Cultural Project Managements',
                university: 'La Fabrica',
                photo: ''
              },
              {
                name: 'Paula Thomas',
                study: 'MA Photographic Projects',
                university: 'La Fabrica',
                photo: ''
              },
            ]
          },
        ]
      },
      {
        city: 'San Sebastian',
        country: 'Spain',
        lat: 43.3183, lng: -1.9812,
        cohorts: [
          {
            start: 2025, end: 2026,
            count: 2,
            scholars: [
              {
                name: 'Frank David Guerra Blanco',
                study: 'MA Cinematographic and Audiovisual Creation',
                university: 'Zine-Eskola',
                photo: ''
              },
              {
                name: 'Noemi Susel Veláquez Legón',
                study: 'MA Film and Audiovisual Archives',
                university: 'Zine-Eskola',
                photo: ''
              },
            ]
          },
        ]
      },
      {
        city: 'Berlin',
        country: 'Germany',
        lat: 52.52, lng: 13.405,
        cohorts: [
          {
            start: 2025, end: 2026,
            count: 6,
            scholars: [
              {
                name: 'Matej Balint',
                study: 'BSc Data Science and Business Analytics',
                university: 'Forward College',
                photo: ''
              },
              {
                name: 'Azra Zukic',
                study: 'MA International Affairs',
                university: 'Hertie School',
                photo: ''
              },
              {
                name: 'Daniel Sidiqie',
                study: 'MA International Affairs',
                university: 'Hertie School',
                photo: ''
              },
              {
                name: 'Beatriz Patrico Pereira da Cruz',
                study: 'MA Public Administration',
                university: 'Hertie School',
                photo: ''
              },
              {
                name: 'Salma Karen Gomez Lopez',
                study: 'MSc Public Policy',
                university: 'Hertie School',
                photo: ''
              },
              {
                name: 'Vikash Kanna Chandra Prasad',
                study: 'Megalai Sustainable Mobility Management',
                university: 'TU Berlin',
                photo: ''
              },
            ]
          },
        ]
      },
      {
        city: 'Glasgow',
        country: 'United Kingdom',
        lat: 55.8642, lng: -4.2518,
        cohorts: [
          {
            start: 2023, end: 2024,
            count: 2,
            scholars: []
          },
          {
            start: 2025, end: 2026,
            count: 8,
            scholars: [
              {
                name: 'Joanna Shulha',
                study: 'MA Illustration',
                university: 'Glasgow School of Art',
                photo: ''
              },
              {
                name: 'Keely McLavin',
                study: 'MLiTT Curation',
                university: 'Glasgow School of Art',
                photo: ''
              },
              {
                name: 'Riccardo Atanasio',
                study: 'MA Musical Theatre (Musical Directing)',
                university: 'Royal Conservatorie Scotland',
                photo: ''
              },
              {
                name: 'Artem Tereshchenko',
                study: 'MA Piano Performance',
                university: 'Royal Conservatorie Scotland',
                photo: ''
              },
              {
                name: 'Jonathan Allen',
                study: 'BEng (Hons) Aero-Mechanical Engineering',
                university: 'Strathclyde University',
                photo: ''
              },
              {
                name: 'Dillon Bricknal',
                study: 'MSc Forensic Science',
                university: 'Strathclyde University',
                photo: ''
              },
              {
                name: 'Mfon-Abasi Michael Inyang',
                study: 'MA TV Fiction Writing',
                university: 'Glasgow Caledonian University',
                photo: ''
              },
              {
                name: 'Caleb Chezhian',
                study: 'MSc Investigative Ophthalmology and Vision Science',
                university: 'Glasgow Caledonian University',
                photo: ''
              },
            ]
          },
        ]
      },
      {
        city: 'Vienna',
        country: 'Austria',
        lat: 48.2082, lng: 16.3738,
        cohorts: [
          {
            start: 2023, end: 2024,
            count: 5,
            scholars: []
          },
          {
            start: 2025, end: 2026,
            count: 10,
            scholars: [
              {
                name: 'Shreya Parajuli',
                study: 'LIM Human Rights Law',
                university: 'Central European University (CEU)',
                photo: ''
              },
              {
                name: 'Alina Zaripova',
                study: 'MA History',
                university: 'Central European University (CEU)',
                photo: ''
              },
              {
                name: 'Danya Aburoumi',
                study: 'MA Human Rights',
                university: 'Central European University (CEU)',
                photo: ''
              },
              {
                name: 'Syuzanna Poghosyan',
                study: 'MA Economics, Data and Policy',
                university: 'Central European University (CEU)',
                photo: ''
              },
              {
                name: 'Anna Andreasyan',
                study: 'MA Sociology and Social Anthropology',
                university: 'Central European University (CEU)',
                photo: ''
              },
              {
                name: 'Asliya Shodghulomova',
                study: 'MSc Environmental Sciences and Policy',
                university: 'Central European University (CEU)',
                photo: ''
              },
              {
                name: 'Ali Usama',
                study: 'MSc Social Data Science',
                university: 'Central European University (CEU)',
                photo: ''
              },
              {
                name: 'Jiayu LI',
                study: 'MA',
                university: 'University of Music and Performance Arts Vienna (MDW)',
                photo: ''
              },
              {
                name: 'Mathapelo Matabane',
                study: 'MA',
                university: 'University of Music and Performance Arts Vienna (MDW)',
                photo: ''
              },
              {
                name: 'Célest Lang',
                study: 'MA of Music Piano',
                university: 'University of Music and Performance Arts Vienna (MDW)',
                photo: ''
              },
            ]
          },
        ]
      },
      {
        city: 'Porto',
        country: 'Portugal',
        lat: 41.1579, lng: -8.6291,
        cohorts: [
          {
            start: 2025, end: 2026,
            count: 9,
            scholars: [
              {
                name: 'Lucy Nyoni',
                study: 'International MBA',
                university: 'Porto Business School',
                photo: ''
              },
              {
                name: 'Omid Akabrian',
                study: 'MSc Business Administration (MBA)',
                university: 'Porto Business School',
                photo: ''
              },
              {
                name: 'Cláudio Manuel António',
                study: 'MA Auditing and Taxation',
                university: 'Universidade Catolica Porto',
                photo: ''
              },
              {
                name: 'Sila Köse',
                study: 'MA Cinema',
                university: 'Universidade Catolica Porto',
                photo: ''
              },
              {
                name: 'Carla Nicole Dominquez Lora',
                study: 'MA Creative Industries Management',
                university: 'Universidade Catolica Porto',
                photo: ''
              },
              {
                name: 'Doris Dadzie',
                study: 'MA Management',
                university: 'Universidade Catolica Porto',
                photo: ''
              },
              {
                name: 'Chukwunwike Humphrey Enelamah',
                study: 'MA Management',
                university: 'Universidade Catolica Porto',
                photo: ''
              },
              {
                name: 'Naman Tariq',
                study: 'MA Law International Studies',
                university: 'Universidade Catolica Porto',
                photo: ''
              },
              {
                name: 'Ana Beatriz Martins Pereira',
                study: 'Integrated MSc in Medicine',
                university: 'Universidade do Porto',
                photo: ''
              },
            ]
          },
        ]
      },
    ];

    // === State & DOM refs ===
    let yearMax = 2026;
    const els = {
      statCities: document.getElementById('stat-cities'),
      statTotal:  document.getElementById('stat-total'),
      yearMax: document.getElementById('year-max'),
      yearLabel: document.getElementById('year-label'),
      resetView: document.getElementById('reset-view'),
      modal: document.getElementById('scholar-modal'),
      modalTitle: document.getElementById('modal-title'),
      scholarSearch: document.getElementById('scholar-search'),
      scholarsContainer: document.getElementById('scholars-container'),
      closeModal: document.getElementById('close-modal'),
    };

    function activeCountFor(city, yMax){
      return city.cohorts
        .filter(c => (c.start || 0) <= yMax)
        .reduce((sum, c) => sum + (c.count || 0), 0);
    }

    function popupHTML(city, yMax){
      const count = activeCountFor(city, yMax);
      const visible = city.cohorts
        .filter(c => (c.start || 0) <= yMax)
        .sort((a,b)=>a.start - b.start);

      const rows = visible.map(c => {
        const recorded = (c.scholars || []).length;
        return `
          <div class="cohort-row">
            <div>
              <strong>${c.start}–${c.end}</strong>
              <div class="meta">
                ${recorded ? `Showing ${recorded} recorded` : 'No profiles recorded yet'} • Total: ${c.count}
              </div>
            </div>
            <button class="btn" onclick="window.__openScholars('${city.city.replace(/'/g,"\\'")}', '${city.country.replace(/'/g,"\\'")}', ${c.start}, ${c.end})">
              View scholars
            </button>
          </div>
        `;
      }).join("");

      return `
        <div>
          <h3>${city.city}, ${city.country}</h3>
          <div class="kpis">
            <div class="kpi">
              <div class="label">Scholars (visible)</div>
              <div class="value">${count}</div>
            </div>
            <div class="kpi">
              <div class="label">Cohorts</div>
              <div class="value">${visible.length}</div>
            </div>
          </div>
          ${rows}
        </div>
      `;
    }

    function buildMarkers(){
      cluster.clearLayers();
      let shownCities = 0;
      let totalScholars = 0;

      cities.forEach(city => {
        const count = activeCountFor(city, yearMax);
        if (count <= 0) return;

        shownCities++;
        totalScholars += count;

        const marker = L.circleMarker([city.lat, city.lng], {
          radius: Math.max(6, Math.min(18, 6 + Math.sqrt(count))),
          weight: 2,
          color: '#f78ca6',
          fillColor: '#FFC2D0',
          fillOpacity: 0.9
        });

        marker.bindPopup(popupHTML(city, yearMax));
        marker.on('click', () => map.setView([city.lat, city.lng], 10, { animate:true }));
        cluster.addLayer(marker);
      });

      map.addLayer(cluster);
      els.statCities.textContent = shownCities;
      els.statTotal.textContent = totalScholars;
    }

    // Modal rendering
    function renderScholars(list){
      els.scholarsContainer.innerHTML = list.map(s => `
        <div class="scholar-card">
          ${s.photo
            ? `<img src="${s.photo}" alt="${s.name || 'Scholar'}" onerror="this.style.display='none'"/>`
            : `<img src="" alt="" style="display:none"/>`
          }
          <div class="scholar-meta">
            <div class="scholar-name">${s.name || 'Unnamed'}</div>
            <div class="scholar-study">${s.study || ''}</div>
            <div class="scholar-uni">${s.university || ''}</div>
            <div class="scholar-tags">
              ${s.cohort ? `<span class="tag">${s.cohort}</span>` : ''}
            </div>
          </div>
        </div>
      `).join('');
    }

    function openScholars(cityName, country, start, end){
      const city = cities.find(c => c.city === cityName && c.country === country);
      if (!city) return;
      const cohort = city.cohorts.find(c => c.start === start && c.end === end) || { scholars:[], count:0 };
      const base = (cohort.scholars || []).map(s => ({
        ...s,
        cohort: `${start}–${end}`
      }));

      els.modalTitle.textContent = `${cityName}, ${country} — ${start}–${end} • Showing ${base.length} of ${cohort.count}`;
      renderScholars(base);
      els.modal.classList.add('open');
      els.modal.setAttribute('aria-hidden','false');
      els.scholarSearch.value = '';

      els.scholarSearch.oninput = () => {
        const q = els.scholarSearch.value.toLowerCase();
        const filtered = base.filter(s =>
          (`${s.name || ''} ${s.study || ''} ${s.university || ''}`).toLowerCase().includes(q)
        );
        renderScholars(filtered);
      };
    }

    function closeModal(){
      els.modal.classList.remove('open');
      els.modal.setAttribute('aria-hidden','true');
      els.scholarSearch.value = '';
    }

    window.__openScholars = openScholars;
    els.closeModal.addEventListener('click', closeModal);
    document.getElementById('scholar-modal').addEventListener('click', e => {
      if (e.target.id === 'scholar-modal') closeModal();
    });

    // Sidebar controls
    els.yearMax.addEventListener('input', e => {
      yearMax = +e.target.value;
      els.yearLabel.textContent = yearMax;
      buildMarkers();
    });
    els.resetView.addEventListener('click', () => map.setView([51.5,9],5));

    // Initial render
    buildMarkers();
  </script>
</body>
</html>
